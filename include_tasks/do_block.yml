---

- name: Including Variable
  include_vars: vars/main.yml

- name: Creating Block Storage
  digital_ocean_block_storage:
    state: present
    command: create
    api_token: "{{ do_token }}"
    region: "{{ do_region }}"
    block_size: "{{ do_volume_size }}"
    volume_name: "{{ do_volume_name }}"
  when: (bw_cmd == "create_volume" or bw_cmd == "create_attach_volume")
  register: _bw_do_create_volume_result
  
- set_fact:
    _do_volume_id: "{{ _bw_do_create_volume_result.id }}"
  when: (_bw_do_create_volume_result is defined) 
  

- name: Attaching Block Storage
  digital_ocean_block_storage:
    state: present
    command: attach
    api_token: "{{ do_token }}"
    region: "{{ do_region }}"
    block_size: "{{ do_volume_size }}"
    volume_name: "{{ do_volume_name }}"
    droplet_id: "{{ do_instance_name }}"
  when: (bw_cmd == "attach_volume" or bw_cmd == "create_attach_volume") and (do_instance_name is defined)
  register: _bw_do_attach_volume_result
  
  
- name: Detaching Block Storage
  digital_ocean_block_storage:
    state: absent
    command: attach
    api_token: "{{ do_token }}"
    region: "{{ do_region }}"
    block_size: "{{ do_volume_size }}"
    volume_name: "{{ do_volume_name }}"
    droplet_id: "{{ do_instance_name }}"
  when: (bw_cmd == "detach_volume") and (do_instance_name is defined)
  register: _bw_do_detach_volume_result  
  
- name: Deleting Block Storage
  digital_ocean_block_storage:
    state: absent
    command: create
    api_token: "{{ do_token }}"
    region: "{{ do_region }}"
    block_size: "{{ do_volume_size }}"
  when: (bw_cmd == "delete_volume")
  register: _bw_do_delete_volume_result   
  